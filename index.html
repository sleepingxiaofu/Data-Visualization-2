<!DOCTYPE html>
<html>
<head>
  <title>Education Access and Equity in Malaysia</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 40px;
      font-size: 16px;
    }
    .vis-section {
      background: white;
      padding: 30px;
      margin: 30px auto;
      max-width: 1200px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .vis-section h2 {
      color: #2c5aa0;
      margin-top: 0;
      border-bottom: 2px solid #2c5aa0;
      padding-bottom: 10px;
    }
    .vis-section p {
      color: #666;
      margin-bottom: 20px;
      line-height: 1.6;
    }
    .vis-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h1>Education Access and Equity in Malaysia</h1>
  <p class="subtitle">Analyzing regional capacity and infrastructure distribution across education stages</p>
  
  <!-- Visualization 1: HW9 Map -->
  <div class="vis-section">
    <h2>Regional Education Capacity by State</h2>
    <p>This choropleth map shows schools per 10,000 population across Malaysian states, revealing significant regional disparities in education infrastructure capacity.</p>
    <div class="vis-container">
      <div id="map"></div>
    </div>
  </div>
  
  <!-- Visualization 2: HW10 Interactive Chart -->
  <div class="vis-section">
    <h2>Education Infrastructure Distribution by Stage</h2>
    <p>This interactive chart breaks down school counts by education stage (Primary, Secondary) across states. Use the dropdown filter to focus on specific education levels.</p>
    <div class="vis-container">
      <div id="bars"></div>
    </div>
  </div>
  
  <script type="text/javascript">
    // Visualization 1: Choropleth Map
    var mapSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 800,
      "height": 600,
      
      "projection": {
        "type": "mercator",
        "center": [109, 4],
        "scale": 2200
      },
      
      "layer": [
        {
          "data": {"sphere": true},
          "mark": {"type": "geoshape", "fill": "#e0f3f8"}
        },
        {
          "data": {"graticule": {"step": [5, 5]}},
          "mark": {
            "type": "geoshape",
            "stroke": "#cccccc",
            "strokeWidth": 0.5,
            "fill": null
          }
        },
        {
          "data": {
            "url": "malaysia_districts.json",
            "format": {
              "type": "topojson",
              "feature": "my"
            }
          },
          "transform": [
            {
              "lookup": "properties.name",
              "from": {
                "data": {"url": "education_capacity_state.csv"},
                "key": "state",
                "fields": ["schools_per_10k"]
              }
            }
          ],
          "mark": {
            "type": "geoshape",
            "stroke": "#666666",
            "strokeWidth": 0.5
          },
          "encoding": {
            "color": {
              "field": "schools_per_10k",
              "type": "quantitative",
              "scale": {
                "scheme": "oranges",
                "domain": [2500, 12000]
              },
              "legend": {
                "title": "Schools per 10,000",
                "orient": "right"
              }
            },
            "tooltip": [
              {"field": "properties.name", "type": "nominal", "title": "State"},
              {
                "field": "schools_per_10k", 
                "type": "quantitative", 
                "title": "Schools per 10,000", 
                "format": ",.0f"
              }
            ]
          }
        }
      ]
    };
    
    // Visualization 2: Interactive Bar Chart - FIXED VERSION
    var barSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 900,
      "height": 500,
      "title": {
        "text": "School Distribution by Education Stage (2022)",
        "fontSize": 18,
        "anchor": "middle",
        "fontWeight": "bold"
      },
      "data": {
        "url": "schools_by_stage_simplified.csv"
      },
      "params": [
        {
          "name": "stage_selection",
          "value": "All",
          "bind": {
            "input": "select",
            "options": ["All", "Primary", "Secondary"],
            "labels": ["All Stages", "Primary Schools Only", "Secondary Schools Only"],
            "name": "Education Stage: "
          }
        }
      ],
      "transform": [
        {
          "filter": "stage_selection == 'All' || datum.stage == stage_selection"
        }
      ],
      "mark": {
        "type": "bar",
        "tooltip": true
      },
      "encoding": {
        "x": {
          "field": "state",
          "type": "nominal",
          "title": "State",
          "sort": {"field": "schools", "op": "sum", "order": "descending"},
          "axis": {
            "labelAngle": -45,
            "labelFontSize": 11,
            "titleFontSize": 13
          }
        },
        "y": {
          "field": "schools",
          "type": "quantitative",
          "title": "Number of Schools",
          "axis": {
            "format": ",",
            "grid": true,
            "titleFontSize": 13
          }
        },
        "color": {
          "field": "stage",
          "type": "nominal",
          "title": "Education Stage",
          "scale": {
            "domain": ["Primary", "Secondary"],
            "range": ["#4472C4", "#ED7D31"]
          },
          "legend": {
            "orient": "top-right",
            "titleFontSize": 12,
            "labelFontSize": 11
          }
        },
        "xOffset": {
          "field": "stage",
          "type": "nominal"
        },
        "tooltip": [
          {
            "field": "state", 
            "type": "nominal", 
            "title": "State"
          },
          {
            "field": "stage", 
            "type": "nominal", 
            "title": "Education Stage"
          },
          {
            "field": "schools", 
            "type": "quantitative", 
            "title": "Number of Schools",
            "format": ","
          },
          {
            "field": "percentage",
            "type": "quantitative",
            "title": "% of State Total",
            "format": ".1f"
          }
        ]
      }
    };
    
    // Add annotation layer separately
    var annotationSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 900,
      "height": 500,
      "data": {
        "values": [
          {
            "x": "Sarawak",
            "y": 2700,
            "text": "‚Üê Sarawak leads with 2,916 total schools (86.8% Primary)"
          }
        ]
      },
      "mark": {
        "type": "text",
        "align": "left",
        "dx": 10,
        "fontSize": 13,
        "fontWeight": "bold",
        "color": "#d62728"
      },
      "encoding": {
        "x": {"field": "x", "type": "nominal"},
        "y": {"field": "y", "type": "quantitative"},
        "text": {"field": "text", "type": "nominal"}
      }
    };
    
    // Embed visualizations
    vegaEmbed('#map', mapSpec, {actions: false});
    vegaEmbed('#bars', barSpec, {actions: false});
  </script>
</body>
</html>

-- check for errors --